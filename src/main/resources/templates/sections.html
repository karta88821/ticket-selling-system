<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <title>Sections</title>
  <div th:replace="fragments/header :: header"></div>
</head>

<body>
  <div th:replace="fragments/nav :: nav" , th:with="activeLink=${activeLink}"></div>

  <div class="container">
    <div class="container">
      <div class="row align-items-center">
        <div class="col">
          <h1>Sections</h1>
        </div>

        <div class="col">
          <button type="button" class="float-right btn btn-primary" data-toggle="modal" data-target="#add-section-modal">Add
            Section</button>
        </div>
      </div>
    </div>

    <div th:replace="fragments/modals :: add-section">modal</div>

    <div>
      <table id="section-table" class="table table-striped table-bordered">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Name</th>
            <th scope="col">Total row</th>
            <th scope="col">Total number per row</th>
            <th scope="col">Price</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="section: ${sections}">
            <td th:text="${section.id}">ID</td>
            <td th:text="${section.name}">Name</td>
            <td th:text="${section.totalRow}">Total row</td>
            <td th:text="${section.totalNumberPerRow}">Total number per row</td>
            <td th:text="${section.price}">Price</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</body>
<script>

  $("#new-section-form").submit(function (event) {
    let formData = {
      name: $("#section-name").val(),
      totalRow: $("#section-total-row").val(),
      totalNumberPerRow: $("#section-total-number-per-row").val(),
      price: $("#section-price").val(),
    };

    $.ajax({
      type: "POST",
      url: "/api/add_section",
      data: JSON.stringify(formData),
      dataType: "json",
      contentType: "application/json;charset=utf-8",
      encode: true,
      success: function(newSection){
        setTimeout(function () {
            location.reload(); 
          }, 2000);
      },
      error: function(xhr, ajaxOptions, thrownError){
        console.log(xhr.status);
        console.log(thrownError);

      }
    });

    // close modal
    $('#add-section-modal').modal('toggle');
    // clear form
    $('#new-section-form')[0].reset();

    event.preventDefault();
  });
</script>

</html>